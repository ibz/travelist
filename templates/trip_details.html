<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="{{ MEDIA_URL }}javascript/trip.js" type="text/javascript"></script>
<script type="text/javascript">
$(function()
{
  init_trip_details(
[{% for p in points %}{lat:{{ p.coords.0 }}, lng:{{ p.coords.1 }}, id:{{ p.id }}, name:"{{ p.name }}", place_id:{{ p.place_id }}, visited:{{ p.visited|lower }} }{% if not forloop.last %},{% endif %}{% endfor %}]);
  $("#trip-details-tabs").show();
});
</script>
</head>
<body>

{% load call %}

<div id="point-data" style="display: none">
{% regroup points_sorted by place_id as places %}
{% for place in places %}
<div id="place-{{ place.grouper }}">
{% for point in place.list %}
<div id="point-{{ point.id }}">
<div class="short-content">
  <div class="body">
    <h4><a href="/places/{{ point.place_id }}/">{{ point.name }}</a></h4>
    <ul class="plain-list">
      <li>
        {% if point.date_arrived or point.date_left %}
          {% if point.date_arrived %}{{ point.date_arrived|date }}{% else %}?{% endif %} - {% if point.date_left %}{{ point.date_left|date }}{% else %}?{% endif %}
        {% endif %}
      </li>
      {% call "_trip_details_annotations.html" with annotations=point.annotations.POINT.ACCOMMODATION empty='' %}
      {% call "_trip_details_annotations.html" with annotations=point.annotations.POINT.EXTERNAL_PHOTOS empty='' %}
      {% call "_trip_details_annotations.html" with annotations=point.annotations.POINT.URL empty='' %}
    </ul>
  </div>
  {% ifequal user trip.user %}
  <div class="footer">
    <hr />
    <a href="/trips/{{ trip.id }}/annotations/new/?content_type=6&point_id={{ point.id }}&segment=0">add accommodation</a>,
    <a href="/trips/{{ trip.id }}/annotations/new/?content_type=3&point_id={{ point.id }}&segment=0">add photos</a>,
    <a href="/trips/{{ trip.id }}/annotations/new/?content_type=2&point_id={{ point.id }}&segment=0">add link</a>
  </div>
  {% endifequal %}
</div>
{% ifequal user trip.user %}
  {% call "_trip_details_annotations_max.html" with annotation_dict=point.annotations.POINT segment=0 %}
{% else %}
  {% if point.annotations.POINT.ACTIVITY or point.annotations.POINT.NOTE or point.annotations.POINT.COST %}
    {% call "_trip_details_annotations_max.html" with annotation_dict=point.annotations.POINT segment=0 %}
  {% endif %}
{% endifequal %}
</div>
{% endfor %}
</div>
{% endfor %}
</div>

<div id="segment-data" style="display: none">
{% regroup segments_sorted by place_ids as place_pairs %}
{% for place_pair in place_pairs %}
<div id="place-pair-{{ place_pair.grouper }}">
{% for segment in place_pair.list %}
<div id="segment-{{ segment.p1.id }}">
<div class="short-content">
  <div class="body">
    <h4><a href="/places/{{ segment.p1.place_id }}/">{{ segment.p1.name }}</a> - <a href="/places/{{ segment.p2.place_id }}/">{{ segment.p2.name }}</a></h4>
    <ul class="plain-list">
      <li>
        {% if segment.p1.date_left or segment.p2.date_arrived %}
        {% if segment.p1.date_left %}{{ segment.p1.date_left|date }}{% else %}?{% endif %} - {% if segment.p2.date_arrived %}{{ segment.p2.date_arrived|date }}{% else %}?{% endif %}
        {% endif %}
      </li>
      <li>Distance: {{ segment.length|floatformat:2 }} km</li>
      {% call "_trip_details_annotations.html" with annotations=segment.p1.annotations.SEGMENT.TRANSPORTATION empty='' %}
      {% call "_trip_details_annotations.html" with annotations=segment.p1.annotations.SEGMENT.EXTERNAL_PHOTOS empty='' %}
      {% call "_trip_details_annotations.html" with annotations=segment.p1.annotations.SEGMENT.URL empty='' %}
    </ul>
  </div>
  {% ifequal user trip.user %}
  <div class="footer">
    <hr />
    <a href="/trips/{{ trip.id }}/annotations/new/?content_type=4&point_id={{ segment.p1.id }}&segment=1">add transportation</a>,
    <a href="/trips/{{ trip.id }}/annotations/new/?content_type=3&point_id={{ segment.p1.id }}&segment=1">add photos</a>,
    <a href="/trips/{{ trip.id }}/annotations/new/?content_type=2&point_id={{ segment.p1.id }}&segment=1">add link</a>
  </div>
  {% endifequal %}
</div>
{% ifequal user trip.user %}
  {% call "_trip_details_annotations_max.html" with annotation_dict=segment.p1.annotations.SEGMENT segment=1 %}
{% else %}
  {% if segment.p1.annotations.SEGMENT.ACTIVITY or segment.p1.annotations.SEGMENT.NOTE or segment.p1.annotations.SEGMENT.COST %}
    {% call "_trip_details_annotations_max.html" with annotation_dict=segment.p1.annotations.SEGMENT segment=1 %}
  {% endif %}
{% endifequal %}
</div>
{% endfor %}
</div>
{% endfor %}
</div>

<div id="trip-details-tabs" style="display: none;">
<ul>
  <li><a href="#points"><span>Places</span></a></li>
  <li><a href="#photos"><span>Photos</span></a></li>
</ul>

<div id="points">
  {% ifequal user.id trip.user_id %}
  <a href="javascript:edit_points({{ trip.id }});">edit places</a>
  {% endifequal %}
  <ul class="plain-list">
    {% for point in points %}
    <li>{{ point.name }} {% if point.visited %}(visit){% endif %}</li>
    {% endfor %}
  </ul>
</div>

<div id="photos">
  {% ifequal user.id trip.user_id %}
    <a href="/trips/{{ trip.id }}/annotations/new/?content_type=3">add photos</a>
  {% endifequal %}
  <ul class="plain-list">
    {% call "_trip_details_annotations.html" with annotations=trip_photos %}
  </ul>
</div>
</div>
</body>
</html>
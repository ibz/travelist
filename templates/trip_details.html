<div id="trip-details-tabs">
<ul>
  <li><a href="#points"><span>Points</span></a></li>
  <li><a href="#segments"><span>Segments</span></a></li>
  <li><a href="#photos"><span>Photos</span></a></li>
</ul>

<div id="points">
  <a href="javascript:edit_points();">edit points</a>
  <ul class="plain-list">
    {% for point in points %}
    <li>
      {% if point.annotation_count or point.date_arrived or point.date_left %}
      <span class="link" onclick="javascript:toggle_annotations('point_{{ forloop.counter }}')">
        <span id="link_point_{{ forloop.counter }}" class="expand-item">+</span>
      {% else %}
      <span>
        <span class="expand-item-disabled">+</span>
      {% endif %}
        {{ point.name }} {% if point.visited %}(visited){% endif %}
      </span>
      <ul id="point_{{ forloop.counter }}" class="plain-list" style="display: none;">
	{% if point.date_arrived or point.date_left %}
          <li>{% if point.date_arrived %}{{ point.date_arrived|date }}{% else %}?{% endif %} - {% if point.date_left %}{{ point.date_left|date }}{% else %}?{% endif %}</li>
	{% endif %}
        {% for annotation in point.annotation_set.all %}
          <li>{{ annotation.ui.render_short }}</li>
        {% endfor %}
      </ul>
    </li>
    {% endfor %}
  </ul>
</div>

<div id="segments">
  <ul class="plain-list">
    {% for segment in segments %}
    <li>
      <span class="link" onclick="javascript:toggle_annotations('segment_{{ forloop.counter }}')">
        <span id="link_segment_{{ forloop.counter }}" class="expand-item">+</span>
          {{ segment.p1.name }} - {{ segment.p2.name }}
      </span>
      <ul id="segment_{{ forloop.counter }}" class="plain-list" style="display: none;">
	<li>Length: {{ segment.length|floatformat:2 }} km</li>
	{% for annotation in segment.annotations %}
	<li>{{ annotation.ui.render_short }}</li>
	{% endfor %}
      </ul>
    </li>
    {% endfor %}
  </ul>
</div>

<div id="photos">
  <ul class="plain-list">
    {% for annotation in trip.annotation_set.all %}
    {% if annotation.is_photos %}
    <li>{{ annotation.ui.render_short }}</li>
    {% endif %}
    {% endfor %}
  </ul>
</div>
</div>

<script type="text/javascript">
function toggle_annotations(id)
{
    var ul = document.getElementById(id);
    ul.style.display = ul.style.display == 'none' ? 'block' : 'none';
    var a = document.getElementById("link_" + id);
    a.textContent = ul.style.display == 'none' ? "+" : "-";
}

function init()
{
    $("#trip-details-tabs > ul").tabs();

    var point_data = [{% for p in points %}[{{ p.coords.coords.0 }}, {{ p.coords.coords.1 }}, "{{ p.name }}"]{% if not forloop.last %},{% endif %}{% endfor %}];
    initTripMap("map", point_data);
}

$(document).ready(init);
</script>

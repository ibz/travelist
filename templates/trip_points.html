<script src="{{ MEDIA_URL }}javascript/trip.js" type="text/javascript"></script>
<script type="text/javascript">
var last_id = 0;
var points = {};
$(document).ready(function()
                  {
                      init_trip_points([
                                       {% for p in points %}
                                       {id: {{ p.id }}, name: "{{ p.name }}", lat: {{ p.coords.coords.0 }}, lng: {{ p.coords.coords.1 }},
                                        date_arrived: "{{ p.date_arrived|default:"" }}", date_left: "{{ p.date_left|default:"" }}",
                                        visited: {% if p.visited %}true{% else %}false{% endif %} }{% if not forloop.last %},{% endif %}
                                       {% endfor %}
                                       ]);
                  });
</script>
<div id="edit-points" class="edit-box">
{% if points %}
<h4>Rearrange the points by dragging them with the mouse</h4>
{% else %}
<h4>Add all the places you've been through. Include the starting and ending point.</h4>
{% endif %}
<ul id="sort-points" class="sortable-list">
</ul>

<ul style="display: none;">
  <li id="point-template">
    <div class="point-view">
      <div>
        <div class="point-name"></div>
        <div class="point-details"></div>
      </div>
      <div class="operations">
    	<a class="point-edit-link">edit</a><br />
        <a class="point-delete-link">delete</a>
      </div>
    </div>
    <div class="point-edit" style="display: none;">
      <div class="values">
        <div>
          <label>Arrived:</label> <input type="text" class="date-arrived" size="10" />
          <label>Left:</label> <input type="text" class="date-left" size="10" />
        </div>
        <div>
          <input type="checkbox" class="visited" value="visited" /> <label class="visited-label">visited</label>
        </div>
      </div>
      <div class="operations">
        <input type="button" class="point-edit-save button positive" value="save" /><br />
        <input type="button" class="point-edit-cancel button negative" value="cancel" />
      </div>
    </div>
  </li>
</ul>

<p>
<input type="text" id="new-place-name" />
<input type="hidden" id="new-place-id" />
<input type="hidden" id="new-place-coords" />
<input type="button" class="button positive" value="Add" onclick="javascript:add_new_point();" />
</p>

<p>
<input type="button" class="button positive" value="Save" onclick="javascript:trip_points_save({{ trip.id }});" />
<input type="button" class="button negative" value="Cancel" onclick="javascript:trip_points_cancel({{ trip.id }});" />
</p>
</div>